# HCSR04 Project

This project allows to test a HCSR04 ultrasound sensor with a PSoC microcontroller.
The HCSR04 sensor is an ultrasound sensor that can be used to measure distances in the 
range between 2 and 400 cm. You can find its datasheet [here](https://www.mouser.com/ds/2/813/HCSR04-1022824.pdf).

## HCSR04 Basic Measurement Principle

The timing diagram of the HCSR04 pins (Trigger and Echo) is shown in the following figure:
![Timing Diagram](https://docs.google.com/drawings/d/e/2PACX-1vR2Mx0T8Nu29KAHRe6r3gqZPM3-l6tjAJZlDajIW4KI_tnTk1SySEOoXJaWqJBsFwzoq2mZl7-9PS2W/pub?w=960&h=720)

In order to measure the distance from the closest object, we can apply the following formulas:

*d = v* x *t* 

where *v* is sound velocity in air, *t* is the time of flight of the wave expressed in microseconds. 

Sound propagation velocity in air is: *v = 331.4 m/s + 0.62 m/°C* x *T* where *T* is the temperature of the air expressed in °C. We consider a constant temperature of 20°C, so our equation can be rearranged as follows:

*d = 343.3 m/s* x *t*

Since the wave has to travel forward and backward, we need to divide the measured time by a factor of 2:

*d = 171.65 t*

Converting the factor to *cm/us*, we get to the final formula:

*d = t/58.25*


## Included projects
The project actually includes three different projects, each one with, hopefully, an increased level of difficulty.

1. **Bare Project**: in this base project, all the operations to control the HCSR04 sensor and
the measurement of the distance from the closed object are performed in the infinite for loop. This does not represent an efficient way of measuring distance with this US sensor, but allows to understand its work principle.
2. **Medium Project**: in this medium project, the 10 uS pulse on the trigger pin is performed in the infinite for loop, while the distance measurement is done in a separate ISR triggered by the echo pin. This project makes use of some more advanded functionalities of the Timer component of PSoC Creator.
3. **Advanced Project**: in this advanced project, we use in an advanced way both the Timer and the PWM components of PSoC Creator. The 10 uS pulse on the trigger pin is generated by a PWM component triggered by a timer. The measurement of distance is performed in a ISR controlled by a Timer.

## Requirements

- PSoC Creator version 4.2. 
- PSoC microcontroller 5LP
- HCSR04 sensor
